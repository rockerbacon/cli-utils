#!/usr/bin/env bash

sysfs=/sys/class/power_supply

function read_stats() {
	ls --color=never "$sysfs" | \
	while read -r bat; do
		if [ -e "$sysfs/$bat/capacity" ]; then
			local capacity=$(cat "$sysfs/$bat/capacity")%
		elif [ -e "$sysfs/$bat/capacity_level" ]; then
			local capacity=$(cat "$sysfs/$bat/capacity_level")
		fi

		if [ -n "$capacity" ]; then
			model=$(cat "$sysfs/$bat/model_name")
			echo "$model: $capacity"
		fi
	done
}

read_stats | while read -r stat; do
	notify-send --category 'sysinfo' "$stat"
done
